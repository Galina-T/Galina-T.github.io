(()=>{"use strict";let e=new Date;const t=document.querySelector("#releaseDate"),n=document.getElementById("date_field");e.setDate(e.getDate()),t.textContent=e.toLocaleDateString("ru",{year:"numeric",month:"2-digit",day:"2-digit",hour12:!1});const s=document.querySelector(".teamName"),o=s.classList;s.addEventListener("click",(()=>{const e=o.toggle("teamNameNew");s.textContent=e?"ÐžÐ±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹":"Gallllery"}));const r={Ð­Ð¿Ð¸Ðº:"ðŸ”¨",Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ:"ðŸ”¨",Ð—Ð°Ð´Ð°Ñ‡Ð°:"ðŸ”¨",ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð°:"ðŸ”¨",ÐžÑˆÐ¸Ð±ÐºÐ°:"ðŸž",Ð”Ð¸Ð·Ð°Ð¹Ð½:"ðŸŽ¨","ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÑƒ":"ðŸž","ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ð´Ð¸Ð·Ð°Ð¹Ð½":"ðŸŽ¨","ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ":"ðŸ”¨"},c=["Ð·Ð°Ð´Ð°Ñ‡Ñƒ","Ð·Ð°Ð´Ð°Ñ‡Ð¸","Ð·Ð°Ð´Ð°Ñ‡"];let a="ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ðµ Ð¿Ð¾Ð»Ðµ (Ð—Ð°Ñ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹)",l="Ð˜ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð²ÐµÑ€ÑÐ¸ÑÑ…";const i=(e,t)=>{const n=e/t,s=Math.floor(10*n);return{start:"ðŸ€°".repeat(s)+"ðŸš€",finish:"ðŸ€°".repeat(10-s)+" "+Math.round(1e3*n)/10+"%"}},u=e=>document.querySelector(e).content.cloneNode(!0),d=(e,t,n)=>{t=e.reduce(((e,t)=>e+t.tasks.length),0),document.querySelector(".progress_start").textContent=i(t,n).start,document.querySelector(".progress_finish").textContent=i(t,n).finish},p=(e,t)=>({prod:[{text:"Done",tasks:e.filter((e=>e.version.includes(t)&&"Ð“Ð¾Ñ‚Ð¾Ð²Ð¾"==e.status)),clname:"done"},{text:"Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ - Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ†Ð¸Ñ",tasks:e.filter((e=>e.version.includes(t)&&("Correction"==e.status||"Testing"==e.status||"Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ"==e.status||"Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ"==e.status||"READY FOR TESTING"==e.status))),clname:"correction"},{text:"Ð² Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸",tasks:e.filter((e=>e.version.includes(t)&&("Tested"==e.status||"in release"==e.status))),clname:"tested"},{text:"Ð¶Ð´Ñ‘Ñ‚ Ñ€ÐµÐ²ÑŒÑŽ",tasks:e.filter((e=>e.version.includes(t)&&"Review"==e.status)),clname:"review"}],backlog:[{text:"Ð² Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ð¸ Hotfix",tasks:e.filter((e=>!e.version.includes(t)&&"Hotfix"==e.priority&&"Ð“Ð¾Ñ‚Ð¾Ð²Ð¾"!=e.status)),clname:"hotfix"},{text:"ÑƒÐ¶Ðµ Ð² Ñ€Ð°Ð±Ð¾Ñ‚Ðµ",tasks:e.filter((e=>!e.version.includes(t)&&"Hotfix"!=e.priority&&"Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ"==e.status)),clname:"work"},{text:"ÑƒÐ¶Ðµ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸",tasks:e.filter((e=>!e.version.includes(t)&&"Hotfix"!=e.priority&&("READY FOR TESTING"==e.status||"Testing"==e.status||"Tested"==e.status))),clname:"tested"},{text:"Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ Ð½Ð° Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ",tasks:e.filter((e=>!e.version.includes(t)&&"Hotfix"!=e.priority&&("Correction"==e.status||"Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ"==e.status))),clname:"notInRelease"},{text:"Ð¶Ð´Ñ‘Ñ‚ Ñ€ÐµÐ²ÑŒÑŽ",tasks:e.filter((e=>!e.version.includes(t)&&"Review"==e.status)),clname:"review"},{text:"On hold",tasks:e.filter((e=>!e.version.includes(t)&&"On hold"==e.status)),clname:"onHold"},{text:"Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¸ Ð² Ð°Ñ€Ñ…Ð¸Ð²",tasks:e.filter((e=>!e.version.includes(t)&&"Archive"==e.status)),clname:"archive"}]}),y=(e,t)=>{const n=[...t.children];for(let e=1;e<n.length;e++)n[e].remove();e.forEach((e=>{const n=e.tasks.length;if(n>0){const s=u("#statusTemplate"),o=s.querySelector(".count"),c=s.querySelector(".list_tasks");o.textContent=n+" "+e.text,o.classList.add(e.clname),e.tasks.forEach((e=>{const t=u("#taskTemplate"),n=t.querySelector(".task_link"),s=t.querySelector(".icon"),o=t.querySelector(".task_text");n.setAttribute("href",`https://jira.burgdev.ru/browse/${e.taskID}`),n.setAttribute("target","_blank"),s.textContent=r[e.type],o.textContent=e.taskID+" "+e.name,c.appendChild(t)})),t.appendChild(s)}}))},m=e=>{let t=[];return e.forEach((e=>{e.tasks.length>0&&e.tasks.forEach((e=>{t=t.concat(e.affectedServices).filter((e=>""!=e))}))})),[...new Set(t)]},f=(e,t)=>{[...t.children].forEach((e=>e.remove())),e.forEach((e=>{const n=u("#serviceTypeTemplate");n.querySelector(".service").textContent=`${e};`,t.appendChild(n)}))};n.addEventListener("input",(function(e){document.querySelector("#releaseDate").textContent=e.target.value.replace(/(\d*)-(\d*)-(\d*)/,"$3.$2.$1")}));const h=document.querySelector("select[name='selectVersions']");let v;h.addEventListener("change",(function(e){const t=e.target.value;x=p(v,t),S=m(x.prod),y(x.prod,q),y(x.backlog,_),f(S,C),d(x.prod,g,k)}));let x={},S=[],g=0,k=0;const q=document.querySelector(".statuses_block__prod"),_=document.querySelector(".statuses_block__backlog"),C=document.querySelector(".affectedServices_list");document.getElementById("csvFile").addEventListener("change",(function(e){const t=e.target.files[0],n=new FileReader;document.querySelector(".input-file-text").textContent=t.name,console.dir(e.target),console.dir(t.name),n.onload=function(e){const t=e.target.result;v=csv_parse_sync.parse(t,{delimiter:"|"});const n=v.splice(0,1)[0];v=v.map((e=>{let t=new Object;return n.forEach(((e,n)=>{t[e]=null==t[e]?""+n:t[e]+" "+n})),{type:e[t["Ð¢Ð¸Ð¿ Ð·Ð°Ð´Ð°Ñ‡Ð¸"]],status:e[t["Ð¡Ñ‚Ð°Ñ‚ÑƒÑ"]],name:e[t["Ð¢ÐµÐ¼Ð°"]],affectedServices:""==t[a]?[]:t[a].split(" ").map((t=>e[t])),taskID:e[t["ÐšÐ»ÑŽÑ‡ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹"]],priority:e[t["ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚"]],version:""==t[l]?[]:t[l].split(" ").map((t=>e[t]))}}));const s=v.reduce(((e,t)=>e.concat(t.version)),[]).filter((e=>""!=e));[...new Set(s)].forEach((e=>{const t=u("#optionVersion"),n=t.querySelector(".option");n.textContent=`${e}`,n.setAttribute("name",`${e}`),h.appendChild(t)}));const o=[{count:(r=v).filter((e=>"Ð—Ð°Ð´Ð°Ñ‡Ð°"==e.type||"ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð°"==e.type||"Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ"==e.type||"Ð­Ð¿Ð¸Ðº"==e.type||"ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ"==e.type)).length,description:"Ð½Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ"},{count:r.filter((e=>"ÐžÑˆÐ¸Ð±ÐºÐ°"==e.type||"ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÑƒ"==e.type)).length,description:"Ð½Ð° Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð³Ð¾Ð²"},{count:r.filter((e=>"Ð”Ð¸Ð·Ð°Ð¹Ð½"==e.type||"ÐŸÐ¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ð° Ð´Ð¸Ð·Ð°Ð¹Ð½"==e.type)).length,description:"Ð½Ð° Ð´Ð¸Ð·Ð°Ð¹Ð½"}];var r;x=p(v,h.value),k=v.length;const i=((e,t)=>{let n;return n=t>100?t%100:t<=20&&t>=10?t:t>20?t%10:t,1==n?e[0]:n>1&&n<5?e[1]:e[2]})(c,k);d(x.prod,g,k),S=m(x.prod),document.querySelector("#container");const E=document.querySelector(".total_tasks"),T=document.querySelector(".list_types"),b=(document.querySelector(".list_status"),document.querySelector(".ending"));E.textContent=`${k}`,b.textContent=`${i}`;const w=u("#countTypeTemplate");w.querySelector(".type_count"),w.querySelector(".type_title"),o.forEach((e=>{if(e.count>0){const t=u("#countTypeTemplate"),n=t.querySelector(".type_count"),s=t.querySelector(".type_title");n.textContent=`${e.count}`,s.textContent=`${e.description}`,T.appendChild(t)}})),y(x.prod,q),y(x.backlog,_),f(S,C)},n.readAsText(t)}))})();